Memory bandwidth
----------------

Disco has a 32-byte internal queue. If bursts are triggered when the queue is half-empty - for simple display modes at least - it would generate 16-beat bursts, lasting 10 clock cycles. Running at 8MHz SYS_CLK, the total available VRAM bandwidth is 12.8MBps. This of course is not fully available for Disco: some needs to be reserved for CPU accesses, refreshes and let's not forget: horizontal and vertical retrace times are not really utilized for frame-buffer reads.

If the queue-handling is changed (or the queue depth is extended) to generate 32-byte bursts, the total bandwidth increases to 14.2MBps.

Supported resolutions
---------------------

According to http://tinyvga.com/vga-timing: VGA pixel clock is 25.175MHz for 640x480. For 320x240, it would be half, 12.5875MHz.

VGA monitors though never really had a resolution of 320x240. The VGA controller instead doubled every scan-line (480 scan-lines) and each pixel (640 pixels). The refresh rate was 60Hz. Since devices at the time surely didn't have the internal memory to store the scan-line needed for doubling, they read it from memory twice. The end result of this is that the average datarate for 640x480 is 18.4Mpixel/s. For 320x240 it's only half of it, around 9.2Mpixel/s. In a modern implementation though we can cheat, and create the internal scan-line store needed for doubling. This would reduce 320x240 datarate to *4.6Mpixel/s*.

Similar techniques can be used to create 256x192 and potentially 512x384 pixel resolutions as well from the VESA 768x576@60Hz or the 1024x768@60Hz base resolutions.

NTSC or PAL TV was different: it used 60Hz (50Hz) field rate, but only 30Hz (25Hz) refresh rate. On top of that, NTSC only guaranteed 200 or so visible scan-lines. So, for TV it was either 320x200x60Hz or 320x240x50Hz. These both turn into the same, *3.84MPixel/s*.

Given that we have, give-or-take, a total of 12MBps VRAM bandwidth, we can expect to support the following:

1. VGA, 640x480 resolution at 4bpp -> ~9.2MBps bandwidth requirement.
2. QGVA, 320x240 resolution at 8bpp, but *with* internal scan-line doubler -> ~4.6MBps
3. TV resolution 320x200 at 8bpp -> ~3.84MBps

Of course the timing generation and resolutions are highly dynamic, but for budgeting purposes it's good to track a few possible modes of operation:

.. TODO:: This table should be generated by some Python code and not maintained here...

Modelines:
   320         240         60 Hz         31.5 kHz            ModeLine "320x240"   12.60 320  328  376  400  240  245  246  262  -HSync -VSync DoubleScan
   640         480         60 Hz         31.5 kHz            ModeLine "640x480"   25.20 640  656  752  800  480  490  492  525  -HSync -VSync
   512         384         60 Hz         48.3631 kHz         ModeLine "512x384"   32.50 512  524  592  672  384  385  388  403  -HSync -VSync DoubleScan
HMDI modeslines:
   640         480         60 Hz         31.4625 kHz         ModeLine "640x480"   25.17 640  656  752  800  480  490  492  525  -HSync -VSync
   720         480         60 Hz         15.7343 kHz         ModeLine "720x480"   13.50 720  739  801  858  480  488  494  524  -HSync -VSync Interlace
   720         480         60 Hz         31.4685 kHz         ModeLine "720x480"   27.00 720  736  798  858  480  489  495  525  -HSync -VSync
   720         576         50 Hz         15.625 kHz          ModeLine "720x576"   13.50 720  732  795  864  576  580  586  624  -HSync -VSync Interlace
   720         576         50 Hz         31.25 kHz           ModeLine "720x576"   27.00 720  732  796  864  576  581  586  625  -HSync -VSync
   1920        1080        50 Hz         28.125 kHz          ModeLine "1920x1080" 74.25 1920 2448 2492 2640 1080 1084 1094 1124 +HSync +VSync Interlace
   1920        1080        60 Hz         33.7182 kHz         ModeLine "1920x1080" 74.18 1920 2008 2052 2200 1080 1084 1094 1124 +HSync +VSync Interlace
   1280        720         50 Hz         37.5 kHz            ModeLine "1280x720"  74.25 1280 1720 1760 1980 720  725  730  750  +HSync +VSync
   1280        720         60 Hz         44.9576 kHz         ModeLine "1280x720"  74.18 1280 1390 1430 1650 720  725  730  750  +HSync +VSync

===================== ===============  ===============  ===============  ===============  ===============  ===============  ===============
 Mode                  640x480          320x240          640x400          320x200          256x192 (a)      256x192 (b)      512x384
===================== ===============  ===============  ===============  ===============  ===============  ===============  ===============
 Refresh rate          60Hz             60Hz             60Hz             60Hz             60Hz             60Hz             60Hz
 Bit depth             4                8                4                8                8                8                4
 Pixel clock           12.5875MHz       12.5875MHz       12.5875MHz       12.5875MHz       11.6773MHz       16.25MHz         16.25MHz
 Base mode             640x480          640x480          640x400          640x400          768x576          1024x768         1024x768
Horizontal timing
 H Back Porch          24               24               24               24               36               40               40
 H Sync Pulse          48               48               48               48               26               34               34
 H Front Porch         8                8                8                8                8                6                6
 H Active area         320              320              320              320              256              256              256
 H Total               400              400              400              400              326              336              336
 H Setup               80               80               80               80               70               80               80
 H Pixel Replication   0.5              1                0.5              0.5              1                2                1
Vertical timing
 V Back Porch          33               33               35               35               17               29               29
 V Sync Pulse          2                2                2                2                3                6                6
 V Front Porch         10               10               12               12               1                3                3
 V Active area         480              480              400              400              576              768              768
 V Total               525              525              449              449              597              806              806
 V Setup               45               45               49               49               21               38               38
 V Pixel Replication   1                2                1                1                3                4                2
Register settings
 h_total               199              199              199              199              162              167              167
 h_back_porch_end      11               11               11               11               17               19               19
 h_sync_end            35               35               35               35               30               36               36
 h_front_porch_end     39               39               39               39               34               39               39
 v_total               524              524              448              448              596              805              805
 v_active_end          479              479              399              399              575              767              767
 v_back_porch_end      512              512              434              434              592              796              796
 v_sync_end_high       514              514              436              436              595              802              802
===================== ===============  ===============  ===============  ===============  ===============  ===============  ===============

Note: high resolution modes produce two pixels per pixel clock, thus horizontal timing is based on half pixels

However, Disco actually has HDMI (well, DVI really, but potato-potato), where 16:9 resolution is more commonplace. If that's what we shoot for, the resolutions become:

320x180 (720p)
480x270 (1080i)

The relevant linux modelines (https://www.mythtv.org/wiki/Modeline_Database):
The values in order are: pixel_clock h_active h_sync_start h_sync_end h_total v_active v_sync_start v_sync_end v_total

1280  720   50 Hz   37.5 kHz       ModeLine "1280x720"  74.25 1280 1720 1760 1980 720  725  730  750  +HSync +VSync
1280  720   60 Hz   44.9576 kHz    ModeLine "1280x720"  74.18 1280 1390 1430 1650 720  725  730  750  +HSync +VSync
1280  720   60 Hz   45 kHz         ModeLine "1280x720"  74.25 1280 1390 1430 1650 720  725  730  750  +HSync +VSync
1920  1080  24 Hz   26.9673 kHz    ModeLine "1920x1080" 74.16 1920 2558 2602 2750 1080 1084 1089 1125 +HSync +VSync
1920  1080  25 Hz   28.125 kHz     ModeLine "1920x1080" 74.25 1920 2448 2492 2640 1080 1084 1089 1125 +HSync +VSync
1920  1080  30 Hz   33.7159 kHz    ModeLine "1920x1080" 89.01 1920 2448 2492 2640 1080 1084 1089 1125 +HSync +VSync

There technically is a 720i, but it seems almost completely unused.

These are nice as they require less than 64k memory at 8bpp and 4bpp respectively. Since we would be replicating each pixel 4x, the actual pixel clock rate would be 74.25/4=18.56MHz. That can be supported at 4bpp, but not 8, unfortunately.
